(()=>{var e,t,n={137:(e,t,n)=>{"use strict";var r=String.prototype.replace,i=/%20/g,o=n(733),s={RFC1738:"RFC1738",RFC3986:"RFC3986"};e.exports=o.assign({default:s.RFC3986,formatters:{RFC1738:function(e){return r.call(e,i,"+")},RFC3986:function(e){return String(e)}}},s)},998:(e,t,n)=>{"use strict";var r=n(733),i=Object.prototype.hasOwnProperty,o=Array.isArray,s={allowDots:!1,allowPrototypes:!1,arrayLimit:20,charset:"utf-8",charsetSentinel:!1,comma:!1,decoder:r.decode,delimiter:"&",depth:5,ignoreQueryPrefix:!1,interpretNumericEntities:!1,parameterLimit:1e3,parseArrays:!0,plainObjects:!1,strictNullHandling:!1},a=function(e){return e.replace(/&#(\d+);/g,(function(e,t){return String.fromCharCode(parseInt(t,10))}))},c=function(e,t){return e&&"string"==typeof e&&t.comma&&e.indexOf(",")>-1?e.split(","):e},u=function(e,t){if(o(e)){for(var n=[],r=0;r<e.length;r+=1)n.push(t(e[r]));return n}return t(e)},l=function(e,t,n,r){if(e){var o=n.allowDots?e.replace(/\.([^.[]+)/g,"[$1]"):e,s=/(\[[^[\]]*])/g,a=n.depth>0&&/(\[[^[\]]*])/.exec(o),u=a?o.slice(0,a.index):o,l=[];if(u){if(!n.plainObjects&&i.call(Object.prototype,u)&&!n.allowPrototypes)return;l.push(u)}for(var d=0;n.depth>0&&null!==(a=s.exec(o))&&d<n.depth;){if(d+=1,!n.plainObjects&&i.call(Object.prototype,a[1].slice(1,-1))&&!n.allowPrototypes)return;l.push(a[1])}return a&&l.push("["+o.slice(a.index)+"]"),function(e,t,n,r){for(var i=r?t:c(t,n),o=e.length-1;o>=0;--o){var s,a=e[o];if("[]"===a&&n.parseArrays)s=[].concat(i);else{s=n.plainObjects?Object.create(null):{};var u="["===a.charAt(0)&&"]"===a.charAt(a.length-1)?a.slice(1,-1):a,l=parseInt(u,10);n.parseArrays||""!==u?!isNaN(l)&&a!==u&&String(l)===u&&l>=0&&n.parseArrays&&l<=n.arrayLimit?(s=[])[l]=i:s[u]=i:s={0:i}}i=s}return i}(l,t,n,r)}};e.exports=function(e,t){var n=function(e){if(!e)return s;if(null!==e.decoder&&void 0!==e.decoder&&"function"!=typeof e.decoder)throw new TypeError("Decoder has to be a function.");if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var t=void 0===e.charset?s.charset:e.charset;return{allowDots:void 0===e.allowDots?s.allowDots:!!e.allowDots,allowPrototypes:"boolean"==typeof e.allowPrototypes?e.allowPrototypes:s.allowPrototypes,arrayLimit:"number"==typeof e.arrayLimit?e.arrayLimit:s.arrayLimit,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:s.charsetSentinel,comma:"boolean"==typeof e.comma?e.comma:s.comma,decoder:"function"==typeof e.decoder?e.decoder:s.decoder,delimiter:"string"==typeof e.delimiter||r.isRegExp(e.delimiter)?e.delimiter:s.delimiter,depth:"number"==typeof e.depth||!1===e.depth?+e.depth:s.depth,ignoreQueryPrefix:!0===e.ignoreQueryPrefix,interpretNumericEntities:"boolean"==typeof e.interpretNumericEntities?e.interpretNumericEntities:s.interpretNumericEntities,parameterLimit:"number"==typeof e.parameterLimit?e.parameterLimit:s.parameterLimit,parseArrays:!1!==e.parseArrays,plainObjects:"boolean"==typeof e.plainObjects?e.plainObjects:s.plainObjects,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:s.strictNullHandling}}(t);if(""===e||null==e)return n.plainObjects?Object.create(null):{};for(var d="string"==typeof e?function(e,t){var n,l={},d=t.ignoreQueryPrefix?e.replace(/^\?/,""):e,h=t.parameterLimit===1/0?void 0:t.parameterLimit,p=d.split(t.delimiter,h),f=-1,g=t.charset;if(t.charsetSentinel)for(n=0;n<p.length;++n)0===p[n].indexOf("utf8=")&&("utf8=%E2%9C%93"===p[n]?g="utf-8":"utf8=%26%2310003%3B"===p[n]&&(g="iso-8859-1"),f=n,n=p.length);for(n=0;n<p.length;++n)if(n!==f){var y,m,v=p[n],_=v.indexOf("]="),b=-1===_?v.indexOf("="):_+1;-1===b?(y=t.decoder(v,s.decoder,g,"key"),m=t.strictNullHandling?null:""):(y=t.decoder(v.slice(0,b),s.decoder,g,"key"),m=u(c(v.slice(b+1),t),(function(e){return t.decoder(e,s.decoder,g,"value")}))),m&&t.interpretNumericEntities&&"iso-8859-1"===g&&(m=a(m)),v.indexOf("[]=")>-1&&(m=o(m)?[m]:m),i.call(l,y)?l[y]=r.combine(l[y],m):l[y]=m}return l}(e,n):e,h=n.plainObjects?Object.create(null):{},p=Object.keys(d),f=0;f<p.length;++f){var g=p[f],y=l(g,d[g],n,"string"==typeof e);h=r.merge(h,y,n)}return r.compact(h)}},149:(e,t,n)=>{"use strict";var r=n(733),i=n(137),o=Object.prototype.hasOwnProperty,s={brackets:function(e){return e+"[]"},comma:"comma",indices:function(e,t){return e+"["+t+"]"},repeat:function(e){return e}},a=Array.isArray,c=Array.prototype.push,u=function(e,t){c.apply(e,a(t)?t:[t])},l=Date.prototype.toISOString,d=i.default,h={addQueryPrefix:!1,allowDots:!1,charset:"utf-8",charsetSentinel:!1,delimiter:"&",encode:!0,encoder:r.encode,encodeValuesOnly:!1,format:d,formatter:i.formatters[d],indices:!1,serializeDate:function(e){return l.call(e)},skipNulls:!1,strictNullHandling:!1},p=function e(t,n,i,o,s,c,l,d,p,f,g,y,m){var v,_=t;if("function"==typeof l?_=l(n,_):_ instanceof Date?_=f(_):"comma"===i&&a(_)&&(_=_.join(",")),null===_){if(o)return c&&!y?c(n,h.encoder,m,"key"):n;_=""}if("string"==typeof(v=_)||"number"==typeof v||"boolean"==typeof v||"symbol"==typeof v||"bigint"==typeof v||r.isBuffer(_))return c?[g(y?n:c(n,h.encoder,m,"key"))+"="+g(c(_,h.encoder,m,"value"))]:[g(n)+"="+g(String(_))];var b,w=[];if(void 0===_)return w;if(a(l))b=l;else{var C=Object.keys(_);b=d?C.sort(d):C}for(var k=0;k<b.length;++k){var x=b[k];s&&null===_[x]||(a(_)?u(w,e(_[x],"function"==typeof i?i(n,x):n,i,o,s,c,l,d,p,f,g,y,m)):u(w,e(_[x],n+(p?"."+x:"["+x+"]"),i,o,s,c,l,d,p,f,g,y,m)))}return w};e.exports=function(e,t){var n,r=e,c=function(e){if(!e)return h;if(null!==e.encoder&&void 0!==e.encoder&&"function"!=typeof e.encoder)throw new TypeError("Encoder has to be a function.");var t=e.charset||h.charset;if(void 0!==e.charset&&"utf-8"!==e.charset&&"iso-8859-1"!==e.charset)throw new TypeError("The charset option must be either utf-8, iso-8859-1, or undefined");var n=i.default;if(void 0!==e.format){if(!o.call(i.formatters,e.format))throw new TypeError("Unknown format option provided.");n=e.format}var r=i.formatters[n],s=h.filter;return("function"==typeof e.filter||a(e.filter))&&(s=e.filter),{addQueryPrefix:"boolean"==typeof e.addQueryPrefix?e.addQueryPrefix:h.addQueryPrefix,allowDots:void 0===e.allowDots?h.allowDots:!!e.allowDots,charset:t,charsetSentinel:"boolean"==typeof e.charsetSentinel?e.charsetSentinel:h.charsetSentinel,delimiter:void 0===e.delimiter?h.delimiter:e.delimiter,encode:"boolean"==typeof e.encode?e.encode:h.encode,encoder:"function"==typeof e.encoder?e.encoder:h.encoder,encodeValuesOnly:"boolean"==typeof e.encodeValuesOnly?e.encodeValuesOnly:h.encodeValuesOnly,filter:s,formatter:r,serializeDate:"function"==typeof e.serializeDate?e.serializeDate:h.serializeDate,skipNulls:"boolean"==typeof e.skipNulls?e.skipNulls:h.skipNulls,sort:"function"==typeof e.sort?e.sort:null,strictNullHandling:"boolean"==typeof e.strictNullHandling?e.strictNullHandling:h.strictNullHandling}}(t);"function"==typeof c.filter?r=(0,c.filter)("",r):a(c.filter)&&(n=c.filter);var l,d=[];if("object"!=typeof r||null===r)return"";l=t&&t.arrayFormat in s?t.arrayFormat:t&&"indices"in t?t.indices?"indices":"repeat":"indices";var f=s[l];n||(n=Object.keys(r)),c.sort&&n.sort(c.sort);for(var g=0;g<n.length;++g){var y=n[g];c.skipNulls&&null===r[y]||u(d,p(r[y],y,f,c.strictNullHandling,c.skipNulls,c.encode?c.encoder:null,c.filter,c.sort,c.allowDots,c.serializeDate,c.formatter,c.encodeValuesOnly,c.charset))}var m=d.join(c.delimiter),v=!0===c.addQueryPrefix?"?":"";return c.charsetSentinel&&("iso-8859-1"===c.charset?v+="utf8=%26%2310003%3B&":v+="utf8=%E2%9C%93&"),m.length>0?v+m:""}},733:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n=Array.isArray,r=function(){for(var e=[],t=0;t<256;++t)e.push("%"+((t<16?"0":"")+t.toString(16)).toUpperCase());return e}(),i=function(e,t){for(var n=t&&t.plainObjects?Object.create(null):{},r=0;r<e.length;++r)void 0!==e[r]&&(n[r]=e[r]);return n};e.exports={arrayToObject:i,assign:function(e,t){return Object.keys(t).reduce((function(e,n){return e[n]=t[n],e}),e)},combine:function(e,t){return[].concat(e,t)},compact:function(e){for(var t=[{obj:{o:e},prop:"o"}],r=[],i=0;i<t.length;++i)for(var o=t[i],s=o.obj[o.prop],a=Object.keys(s),c=0;c<a.length;++c){var u=a[c],l=s[u];"object"==typeof l&&null!==l&&-1===r.indexOf(l)&&(t.push({obj:s,prop:u}),r.push(l))}return function(e){for(;e.length>1;){var t=e.pop(),r=t.obj[t.prop];if(n(r)){for(var i=[],o=0;o<r.length;++o)void 0!==r[o]&&i.push(r[o]);t.obj[t.prop]=i}}}(t),e},decode:function(e,t,n){var r=e.replace(/\+/g," ");if("iso-8859-1"===n)return r.replace(/%[0-9a-f]{2}/gi,unescape);try{return decodeURIComponent(r)}catch(e){return r}},encode:function(e,t,n){if(0===e.length)return e;var i=e;if("symbol"==typeof e?i=Symbol.prototype.toString.call(e):"string"!=typeof e&&(i=String(e)),"iso-8859-1"===n)return escape(i).replace(/%u[0-9a-f]{4}/gi,(function(e){return"%26%23"+parseInt(e.slice(2),16)+"%3B"}));for(var o="",s=0;s<i.length;++s){var a=i.charCodeAt(s);45===a||46===a||95===a||126===a||a>=48&&a<=57||a>=65&&a<=90||a>=97&&a<=122?o+=i.charAt(s):a<128?o+=r[a]:a<2048?o+=r[192|a>>6]+r[128|63&a]:a<55296||a>=57344?o+=r[224|a>>12]+r[128|a>>6&63]+r[128|63&a]:(s+=1,a=65536+((1023&a)<<10|1023&i.charCodeAt(s)),o+=r[240|a>>18]+r[128|a>>12&63]+r[128|a>>6&63]+r[128|63&a])}return o},isBuffer:function(e){return!(!e||"object"!=typeof e||!(e.constructor&&e.constructor.isBuffer&&e.constructor.isBuffer(e)))},isRegExp:function(e){return"[object RegExp]"===Object.prototype.toString.call(e)},merge:function e(r,o,s){if(!o)return r;if("object"!=typeof o){if(n(r))r.push(o);else{if(!r||"object"!=typeof r)return[r,o];(s&&(s.plainObjects||s.allowPrototypes)||!t.call(Object.prototype,o))&&(r[o]=!0)}return r}if(!r||"object"!=typeof r)return[r].concat(o);var a=r;return n(r)&&!n(o)&&(a=i(r,s)),n(r)&&n(o)?(o.forEach((function(n,i){if(t.call(r,i)){var o=r[i];o&&"object"==typeof o&&n&&"object"==typeof n?r[i]=e(o,n,s):r.push(n)}else r[i]=n})),r):Object.keys(o).reduce((function(n,r){var i=o[r];return t.call(n,r)?n[r]=e(n[r],i,s):n[r]=i,n}),a)}}},249:function(e,t,n){var r;e.exports=(r=r||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==n.g&&n.g.crypto&&(r=n.g.crypto),!r)try{r=n(480)}catch(e){}var i=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},o=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),s={},a=s.lib={},c=a.Base={extend:function(e){var t=o(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},u=a.WordArray=c.extend({init:function(e,t){e=this.words=e||[],this.sigBytes=null!=t?t:4*e.length},toString:function(e){return(e||d).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var o=0;o<i;o++){var s=n[o>>>2]>>>24-o%4*8&255;t[r+o>>>2]|=s<<24-(r+o)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=c.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new u.init(t,e)}}),l=s.enc={},d=l.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push((o>>>4).toString(16)),r.push((15&o).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new u.init(n,t/2)}},h=l.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var o=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new u.init(n,t)}},p=l.Utf8={stringify:function(e){try{return decodeURIComponent(escape(h.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return h.parse(unescape(encodeURIComponent(e)))}},f=a.BufferedBlockAlgorithm=c.extend({reset:function(){this._data=new u.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=p.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,o=r.sigBytes,s=this.blockSize,a=o/(4*s),c=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*s,l=e.min(4*c,o);if(c){for(var d=0;d<c;d+=s)this._doProcessBlock(i,d);n=i.splice(0,c),r.sigBytes-=l}return new u.init(n,l)},clone:function(){var e=c.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(a.Hasher=f.extend({cfg:c.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){f.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),s.algo={});return s}(Math),r)},269:function(e,t,n){var r,i,o;e.exports=(r=n(249),o=(i=r).lib.WordArray,i.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],o=0;o<n;o+=3)for(var s=(t[o>>>2]>>>24-o%4*8&255)<<16|(t[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|t[o+2>>>2]>>>24-(o+2)%4*8&255,a=0;a<4&&o+.75*a<n;a++)i.push(r.charAt(s>>>6*(3-a)&63));var c=r.charAt(64);if(c)for(;i.length%4;)i.push(c);return i.join("")},parse:function(e){var t=e.length,n=this._map,r=this._reverseMap;if(!r){r=this._reverseMap=[];for(var i=0;i<n.length;i++)r[n.charCodeAt(i)]=i}var s=n.charAt(64);if(s){var a=e.indexOf(s);-1!==a&&(t=a)}return function(e,t,n){for(var r=[],i=0,s=0;s<t;s++)if(s%4){var a=n[e.charCodeAt(s-1)]<<s%4*2|n[e.charCodeAt(s)]>>>6-s%4*2;r[i>>>2]|=a<<24-i%4*8,i++}return o.create(r,i)}(e,t,r)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="},r.enc.Base64)},153:function(e,t,n){var r;e.exports=(r=n(249),function(e){var t=r,n=t.lib,i=n.WordArray,o=n.Hasher,s=t.algo,a=[],c=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(a[i]=n(e.pow(r,.5))),c[i]=n(e.pow(r,1/3)),i++),r++}();var u=[],l=s.SHA256=o.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],o=n[2],s=n[3],a=n[4],l=n[5],d=n[6],h=n[7],p=0;p<64;p++){if(p<16)u[p]=0|e[t+p];else{var f=u[p-15],g=(f<<25|f>>>7)^(f<<14|f>>>18)^f>>>3,y=u[p-2],m=(y<<15|y>>>17)^(y<<13|y>>>19)^y>>>10;u[p]=g+u[p-7]+m+u[p-16]}var v=r&i^r&o^i&o,_=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),b=h+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&l^~a&d)+c[p]+u[p];h=d,d=l,l=a,a=s+b|0,s=o,o=i,i=r,r=b+(_+v)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+o|0,n[3]=n[3]+s|0,n[4]=n[4]+a|0,n[5]=n[5]+l|0,n[6]=n[6]+d|0,n[7]=n[7]+h|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=o._createHelper(l),t.HmacSHA256=o._createHmacHelper(l)}(Math),r.SHA256)},227:(e,t,n)=>{t.formatArgs=function(t){if(t[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+t[0]+(this.useColors?"%c ":" ")+"+"+e.exports.humanize(this.diff),!this.useColors)return;const n="color: "+this.color;t.splice(1,0,n,"color: inherit");let r=0,i=0;t[0].replace(/%[a-zA-Z%]/g,(e=>{"%%"!==e&&(r++,"%c"===e&&(i=r))})),t.splice(i,0,n)},t.save=function(e){try{e?t.storage.setItem("debug",e):t.storage.removeItem("debug")}catch(e){}},t.load=function(){let e;try{e=t.storage.getItem("debug")}catch(e){}return!e&&"undefined"!=typeof process&&"env"in process&&(e=process.env.DEBUG),e},t.useColors=function(){return!("undefined"==typeof window||!window.process||"renderer"!==window.process.type&&!window.process.__nwjs)||("undefined"==typeof navigator||!navigator.userAgent||!navigator.userAgent.toLowerCase().match(/(edge|trident)\/(\d+)/))&&("undefined"!=typeof document&&document.documentElement&&document.documentElement.style&&document.documentElement.style.WebkitAppearance||"undefined"!=typeof window&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/firefox\/(\d+)/)&&parseInt(RegExp.$1,10)>=31||"undefined"!=typeof navigator&&navigator.userAgent&&navigator.userAgent.toLowerCase().match(/applewebkit\/(\d+)/))},t.storage=function(){try{return localStorage}catch(e){}}(),t.destroy=(()=>{let e=!1;return()=>{e||(e=!0,console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`."))}})(),t.colors=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"],t.log=console.debug||console.log||(()=>{}),e.exports=n(447)(t);const{formatters:r}=e.exports;r.j=function(e){try{return JSON.stringify(e)}catch(e){return"[UnexpectedJSONParseError]: "+e.message}}},447:(e,t,n)=>{e.exports=function(e){function t(e){let n,i,o,s=null;function a(...e){if(!a.enabled)return;const r=a,i=Number(new Date),o=i-(n||i);r.diff=o,r.prev=n,r.curr=i,n=i,e[0]=t.coerce(e[0]),"string"!=typeof e[0]&&e.unshift("%O");let s=0;e[0]=e[0].replace(/%([a-zA-Z%])/g,((n,i)=>{if("%%"===n)return"%";s++;const o=t.formatters[i];if("function"==typeof o){const t=e[s];n=o.call(r,t),e.splice(s,1),s--}return n})),t.formatArgs.call(r,e),(r.log||t.log).apply(r,e)}return a.namespace=e,a.useColors=t.useColors(),a.color=t.selectColor(e),a.extend=r,a.destroy=t.destroy,Object.defineProperty(a,"enabled",{enumerable:!0,configurable:!1,get:()=>null!==s?s:(i!==t.namespaces&&(i=t.namespaces,o=t.enabled(e)),o),set:e=>{s=e}}),"function"==typeof t.init&&t.init(a),a}function r(e,n){const r=t(this.namespace+(void 0===n?":":n)+e);return r.log=this.log,r}function i(e){return e.toString().substring(2,e.toString().length-2).replace(/\.\*\?$/,"*")}return t.debug=t,t.default=t,t.coerce=function(e){return e instanceof Error?e.stack||e.message:e},t.disable=function(){const e=[...t.names.map(i),...t.skips.map(i).map((e=>"-"+e))].join(",");return t.enable(""),e},t.enable=function(e){let n;t.save(e),t.namespaces=e,t.names=[],t.skips=[];const r=("string"==typeof e?e:"").split(/[\s,]+/),i=r.length;for(n=0;n<i;n++)r[n]&&("-"===(e=r[n].replace(/\*/g,".*?"))[0]?t.skips.push(new RegExp("^"+e.slice(1)+"$")):t.names.push(new RegExp("^"+e+"$")))},t.enabled=function(e){if("*"===e[e.length-1])return!0;let n,r;for(n=0,r=t.skips.length;n<r;n++)if(t.skips[n].test(e))return!1;for(n=0,r=t.names.length;n<r;n++)if(t.names[n].test(e))return!0;return!1},t.humanize=n(824),t.destroy=function(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")},Object.keys(e).forEach((n=>{t[n]=e[n]})),t.names=[],t.skips=[],t.formatters={},t.selectColor=function(e){let n=0;for(let t=0;t<e.length;t++)n=(n<<5)-n+e.charCodeAt(t),n|=0;return t.colors[Math.abs(n)%t.colors.length]},t.enable(t.load()),t}},643:e=>{e.exports=!1},729:e=>{"use strict";var t=Object.prototype.hasOwnProperty,n="~";function r(){}function i(e,t,n){this.fn=e,this.context=t,this.once=n||!1}function o(e,t,r,o,s){if("function"!=typeof r)throw new TypeError("The listener must be a function");var a=new i(r,o||e,s),c=n?n+t:t;return e._events[c]?e._events[c].fn?e._events[c]=[e._events[c],a]:e._events[c].push(a):(e._events[c]=a,e._eventsCount++),e}function s(e,t){0==--e._eventsCount?e._events=new r:delete e._events[t]}function a(){this._events=new r,this._eventsCount=0}Object.create&&(r.prototype=Object.create(null),(new r).__proto__||(n=!1)),a.prototype.eventNames=function(){var e,r,i=[];if(0===this._eventsCount)return i;for(r in e=this._events)t.call(e,r)&&i.push(n?r.slice(1):r);return Object.getOwnPropertySymbols?i.concat(Object.getOwnPropertySymbols(e)):i},a.prototype.listeners=function(e){var t=n?n+e:e,r=this._events[t];if(!r)return[];if(r.fn)return[r.fn];for(var i=0,o=r.length,s=new Array(o);i<o;i++)s[i]=r[i].fn;return s},a.prototype.listenerCount=function(e){var t=n?n+e:e,r=this._events[t];return r?r.fn?1:r.length:0},a.prototype.emit=function(e,t,r,i,o,s){var a=n?n+e:e;if(!this._events[a])return!1;var c,u,l=this._events[a],d=arguments.length;if(l.fn){switch(l.once&&this.removeListener(e,l.fn,void 0,!0),d){case 1:return l.fn.call(l.context),!0;case 2:return l.fn.call(l.context,t),!0;case 3:return l.fn.call(l.context,t,r),!0;case 4:return l.fn.call(l.context,t,r,i),!0;case 5:return l.fn.call(l.context,t,r,i,o),!0;case 6:return l.fn.call(l.context,t,r,i,o,s),!0}for(u=1,c=new Array(d-1);u<d;u++)c[u-1]=arguments[u];l.fn.apply(l.context,c)}else{var h,p=l.length;for(u=0;u<p;u++)switch(l[u].once&&this.removeListener(e,l[u].fn,void 0,!0),d){case 1:l[u].fn.call(l[u].context);break;case 2:l[u].fn.call(l[u].context,t);break;case 3:l[u].fn.call(l[u].context,t,r);break;case 4:l[u].fn.call(l[u].context,t,r,i);break;default:if(!c)for(h=1,c=new Array(d-1);h<d;h++)c[h-1]=arguments[h];l[u].fn.apply(l[u].context,c)}}return!0},a.prototype.on=function(e,t,n){return o(this,e,t,n,!1)},a.prototype.once=function(e,t,n){return o(this,e,t,n,!0)},a.prototype.removeListener=function(e,t,r,i){var o=n?n+e:e;if(!this._events[o])return this;if(!t)return s(this,o),this;var a=this._events[o];if(a.fn)a.fn!==t||i&&!a.once||r&&a.context!==r||s(this,o);else{for(var c=0,u=[],l=a.length;c<l;c++)(a[c].fn!==t||i&&!a[c].once||r&&a[c].context!==r)&&u.push(a[c]);u.length?this._events[o]=1===u.length?u[0]:u:s(this,o)}return this},a.prototype.removeAllListeners=function(e){var t;return e?(t=n?n+e:e,this._events[t]&&s(this,t)):(this._events=new r,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=n,a.EventEmitter=a,e.exports=a},792:(e,t,n)=>{var r=null;"undefined"!=typeof WebSocket?r=WebSocket:"undefined"!=typeof MozWebSocket?r=MozWebSocket:void 0!==n.g?r=n.g.WebSocket||n.g.MozWebSocket:"undefined"!=typeof window?r=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(r=self.WebSocket||self.MozWebSocket),e.exports=r},104:(e,t,n)=>{var r,i,o;!function(s){if("object"==typeof e.exports){var a=s(n(636),t);void 0!==a&&(e.exports=a)}else i=[n,t],void 0===(o="function"==typeof(r=s)?r.apply(t,i):r)||(e.exports=o)}((function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Timeout=t.repeatedStart=t.delayError=t.callbackError=void 0,t.callbackError="Expeting to get a cb function as the first argument",t.delayError="Delay argument should be a number >= 0",t.repeatedStart="Timeout was already started";var n=function(){function e(e,n){this._pending=!1,this._canceled=!1,this._paused=!1;var r="number"==typeof e?e:n;if("number"!=typeof r||r<0)throw new Error(t.delayError);this._delay=r,this._timeLeft=r,"number"!=typeof e&&this.start(e)}return Object.defineProperty(e.prototype,"isPending",{get:function(){return this._pending},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isStarted",{get:function(){return null!=this._startTime},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isCanceled",{get:function(){return this._canceled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFinished",{get:function(){return!this.isPending&&!this._canceled},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"isFinishedPreemptively",{get:function(){return this.isFinished&&this._timeLeft>0},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timeLeft",{get:function(){return!this._pending||this._paused?this._timeLeft:this._delay-((new Date).getTime()-this._startTime)},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"timePassed",{get:function(){return this._delay-this.timeLeft},enumerable:!1,configurable:!0}),e.prototype._run=function(){var e=this;this._startTime=(new Date).getTime(),this._pending=!0,this._canceled=!1,this._paused=!1,this._to=setTimeout((function(){e._to=null,e._pending=!1,e._timeLeft=0,e._cb()}),this._timeLeft)},e.prototype._halt=function(){this._to&&(clearTimeout(this._to),this._to=null),this._timeLeft=this.timeLeft},e.prototype.start=function(e){var n=this;if(null!=e){if("function"!=typeof e)throw new Error(t.callbackError);return!this._pending&&(this._cb=e,this._run(),!0)}return new Promise((function(e,r){if(n._pending)return r(t.repeatedStart);n._cb=e,n._run()}))},e.prototype.cancel=function(){return!!this._pending&&(this._halt(),this._pending=!1,this._canceled=!0,!0)},e.prototype.execute=function(){return!!this._pending&&(this._halt(),this._pending=!1,this._cb(),!0)},e.prototype.pause=function(){return!(!this._pending||this._paused||(this._halt(),this._paused=!0,0))},e.prototype.resume=function(){return!(!this._pending||!this._paused||(this._run(),0))},Object.defineProperty(e.prototype,"paused",{get:function(){return this._paused},set:function(e){e?this.pause():this.resume()},enumerable:!1,configurable:!0}),e.prototype.reset=function(e){if(null==e&&(e=this._delay),"number"!=typeof e||e<0)throw new Error(t.delayError);if(this.isStarted){if(!this.isPending)return!1;this._halt(),this._delay=e,this._timeLeft=e,this._run()}else this._delay=e,this._timeLeft=e;return!0},Object.defineProperty(e.prototype,"delay",{get:function(){return this._delay},enumerable:!1,configurable:!0}),e}();t.Timeout=n,t.default=n}))},636:e=>{function t(e){var t=new Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=636,e.exports=t},824:e=>{var t=1e3,n=60*t,r=60*n,i=24*r;function o(e,t,n,r){var i=t>=1.5*n;return Math.round(e/n)+" "+r+(i?"s":"")}e.exports=function(e,s){s=s||{};var a,c,u=typeof e;if("string"===u&&e.length>0)return function(e){if(!((e=String(e)).length>100)){var o=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(e);if(o){var s=parseFloat(o[1]);switch((o[2]||"ms").toLowerCase()){case"years":case"year":case"yrs":case"yr":case"y":return 315576e5*s;case"weeks":case"week":case"w":return 6048e5*s;case"days":case"day":case"d":return s*i;case"hours":case"hour":case"hrs":case"hr":case"h":return s*r;case"minutes":case"minute":case"mins":case"min":case"m":return s*n;case"seconds":case"second":case"secs":case"sec":case"s":return s*t;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return s;default:return}}}}(e);if("number"===u&&isFinite(e))return s.long?(a=e,(c=Math.abs(a))>=i?o(a,c,i,"day"):c>=r?o(a,c,r,"hour"):c>=n?o(a,c,n,"minute"):c>=t?o(a,c,t,"second"):a+" ms"):function(e){var o=Math.abs(e);return o>=i?Math.round(e/i)+"d":o>=r?Math.round(e/r)+"h":o>=n?Math.round(e/n)+"m":o>=t?Math.round(e/t)+"s":e+"ms"}(e);throw new Error("val is not a non-empty string or a valid number. val="+JSON.stringify(e))}},300:(e,t)=>{"use strict";var n=function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n)return n;throw new Error("unable to locate global object")}();e.exports=t=n.fetch,n.fetch&&(t.default=n.fetch.bind(n)),t.Headers=n.Headers,t.Request=n.Request,t.Response=n.Response},480:()=>{}},r={};function i(e){var t=r[e];if(void 0!==t)return t.exports;var o=r[e]={exports:{}};return n[e].call(o.exports,o,o.exports,i),o.exports}t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__,i.t=function(n,r){if(1&r&&(n=this(n)),8&r)return n;if("object"==typeof n&&n){if(4&r&&n.__esModule)return n;if(16&r&&"function"==typeof n.then)return n}var o=Object.create(null);i.r(o);var s={};e=e||[null,t({}),t([]),t(t)];for(var a=2&r&&n;"object"==typeof a&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach((e=>s[e]=()=>n[e]));return s.default=()=>n,i.d(o,s),o},i.d=(e,t)=>{for(var n in t)i.o(t,n)&&!i.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},i.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),i.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),i.r=e=>{"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},(()=>{"use strict";var e=function(t,n){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n])},e(t,n)};function t(t,n){if("function"!=typeof n&&null!==n)throw new TypeError("Class extends value "+String(n)+" is not a constructor or null");function r(){this.constructor=t}e(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function n(e,t,n,r){var i,o=arguments.length,s=o<3?t:null===r?r=Object.getOwnPropertyDescriptor(t,n):r;if("object"==typeof Reflect&&"function"==typeof Reflect.decorate)s=Reflect.decorate(e,t,n,r);else for(var a=e.length-1;a>=0;a--)(i=e[a])&&(s=(o<3?i(s):o>3?i(t,n,s):i(t,n))||s);return o>3&&s&&Object.defineProperty(t,n,s),s}function r(e,t,n,r){return new(n||(n=Promise))((function(i,o){function s(e){try{c(r.next(e))}catch(e){o(e)}}function a(e){try{c(r.throw(e))}catch(e){o(e)}}function c(e){var t;e.done?i(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(s,a)}c((r=r.apply(e,t||[])).next())}))}function o(e,t){var n,r,i,o,s={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:a(0),throw:a(1),return:a(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function a(o){return function(a){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;s;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return s.label++,{value:o[1],done:!1};case 5:s.label++,r=o[1],o=[0];continue;case 7:o=s.ops.pop(),s.trys.pop();continue;default:if(!((i=(i=s.trys).length>0&&i[i.length-1])||6!==o[0]&&2!==o[0])){s=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){s.label=o[1];break}if(6===o[0]&&s.label<i[1]){s.label=i[1],i=o;break}if(i&&s.label<i[2]){s.label=i[2],s.ops.push(o);break}i[2]&&s.ops.pop(),s.trys.pop();continue}o=t.call(e,s)}catch(e){o=[6,e],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,a])}}}function s(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")}function a(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,i,o=n.call(e),s=[];try{for(;(void 0===t||t-- >0)&&!(r=o.next()).done;)s.push(r.value)}catch(e){i={error:e}}finally{try{r&&!r.done&&(n=o.return)&&n.call(o)}finally{if(i)throw i.error}}return s}function c(){for(var e=[],t=0;t<arguments.length;t++)e=e.concat(a(arguments[t]));return e}function u(e){return void 0===e&&(e=!0),function(t,n){Object.defineProperty(t,n,{get:function(){},set:function(t){Object.defineProperty(this,n,{value:t,writable:!0,enumerable:e})},enumerable:e})}}function l(e,t,n){return r=>{const i=n?function(){return`[${t}#${this[n]} - please check https://twurple.js.org/reference/${e}/classes/${t}.html for available properties]`}:function(){return`[${t} - please check https://twurple.js.org/reference/${e}/classes/${t}.html for available properties]`};Object.defineProperty(r.prototype,Symbol.for("nodejs.util.inspect.custom"),{value:i,enumerable:!1})}}Object.create,Object.create;var d=i(300),h=d.default||d;const p=d.Headers;d.Request,d.Response;var f=i(149);i(998),i(137);class g extends Error{constructor(e,t){var n;super(e,t),Object.setPrototypeOf(this,new.target.prototype),null===(n=Error.captureStackTrace)||void 0===n||n.call(Error,this,new.target.constructor)}get name(){return this.constructor.name}}class y extends g{constructor(e,t,n,r,i,o){super(`Encountered HTTP status code ${e}: ${t}\n\nURL: ${n}\nMethod: ${r}\nBody:\n${!o&&i.length>150?`${i.slice(0,147)}...`:i}`),this._statusCode=e,this._url=n,this._method=r,this._body=i}get statusCode(){return this._statusCode}get url(){return this._url}get method(){return this._method}get body(){return this._body}}async function m(e,t,n,r,i={}){const o=await async function(e,t,n,r,i={}){var o,s;const a=null!==(o=e.type)&&void 0!==o?o:"helix",c=function(e,t){switch(t){case"helix":return`https://api.twitch.tv/helix/${e.replace(/^\//,"")}`;case"auth":return`https://id.twitch.tv/oauth2/${e.replace(/^\//,"")}`;default:return e}}(e.url,a),u=f(e.query,{arrayFormat:"repeat",addQueryPrefix:!0}),l=new p({Accept:"application/json"});let d;e.jsonBody&&(d=JSON.stringify(e.jsonBody),l.append("Content-Type","application/json")),t&&"auth"!==a&&l.append("Client-ID",t),n&&l.append("Authorization",`${"helix"===a?null!=r?r:"Bearer":"OAuth"} ${n}`);const g={...i,method:null!==(s=e.method)&&void 0!==s?s:"GET",headers:l,body:d};return await function(e,t){return/^\/\//.test(e)&&(e="https:"+e),h.call(this,e,t)}(`${c}${u}`,g)}(e,t,n,r,i);return await async function(e,t){var n;if(!e.ok){const r="application/json"===e.headers.get("Content-Type"),i=r?JSON.stringify(await e.json(),null,2):await e.text(),o=f(t.query,{arrayFormat:"repeat",addQueryPrefix:!0}),s=`${t.url}${o}`;throw new y(e.status,e.statusText,s,null!==(n=t.method)&&void 0!==n?n:"GET",i,r)}}(o,e),await async function(e){if(204===e.status)return;const t=await e.text();return t?JSON.parse(t):void 0}(o)}class v extends g{constructor(e){super("Invalid token supplied",e)}}function _(e){return null==e}function b(e,t){return _(e)?void 0:t(e)}const w=Symbol("twurpleRawData");class C{constructor(e){this[w]=e}}let k=class extends C{constructor(e){super(e),this._obtainmentDate=new Date}get clientId(){return this[w].client_id}get userId(){var e;return null!==(e=this[w].user_id)&&void 0!==e?e:null}get userName(){var e;return null!==(e=this[w].login)&&void 0!==e?e:null}get scopes(){return this[w].scopes}get expiryDate(){return t=e=>new Date(this._obtainmentDate.getTime()+1e3*e),_(e=this[w].expires_in)?null:t(e);var e,t}};async function x(e,t){try{const n=await m({type:"auth",url:"validate"},t,e);return new k(n)}catch(e){if(e instanceof y&&401===e.statusCode)throw new v({cause:e});throw e}}async function S(e,t,n){let r=null;try{const n=await e.getAccessToken(t);if(n)return{accessToken:n,tokenInfo:await x(n.accessToken)}}catch(e){e instanceof v?r=e:null==n||n.error(`Retrieving an access token failed: ${e.message}`)}if(null==n||n.warn("No valid token available; trying to refresh"),e.refresh)try{const t=await e.refresh();if(t)return{accessToken:t,tokenInfo:await x(t.accessToken)}}catch(e){e instanceof v?r=e:null==n||n.error(`Refreshing the access token failed: ${e.message}`)}throw null!=r?r:new Error("Could not retrieve a valid token")}k=n([l("auth","TokenInfo","clientId")],k);const I=new Map([["channel_commercial",["channel:edit:commercial"]],["channel_editor",["channel:manage:broadcast"]],["channel_read",["channel:read:stream_key"]],["channel_subscriptions",["channel:read:subscriptions"]],["user_blocks_read",["user:read:blocked_users"]],["user_blocks_edit",["user:manage:blocked_users"]],["user_follows_edit",["user:edit:follows"]],["user_read",["user:read:email"]],["user_subscriptions",["user:read:subscriptions"]],["user:edit:broadcast",["channel:manage:broadcast","channel:manage:extensions"]]]);let O=class{constructor(e,t,n,r="user"){this._clientId=e||"",this.tokenType=r,this._accessToken="string"==typeof t?{accessToken:t,refreshToken:null,scope:null!=n?n:[],expiresIn:null,obtainmentTimestamp:Date.now()}:t,this._scopes=n}async getAccessToken(e){return this._scopes=await async function(e,t,n,r){if(null==r?void 0:r.length){const i=null!=n?n:(await x(t,e)).scopes;return function(e,t){if(void 0!==t){const n=new Set(e.flatMap((e=>{var t;return[e,...null!==(t=I.get(e))&&void 0!==t?t:[]]})));if(t.some((e=>!n.has(e))))throw new Error(`This token does not have the requested scopes (${t.join(", ")}) and can not be upgraded.\nIf you need dynamically upgrading scopes, please implement the AuthProvider interface accordingly:\n\n\thttps://twurple.js.org/reference/auth/interfaces/AuthProvider.html`)}}(i,r),i}return n}(this._clientId,this._accessToken.accessToken,this._scopes,e),this._accessToken}get clientId(){return this._clientId}get currentScopes(){var e;return null!==(e=this._scopes)&&void 0!==e?e:[]}};n([u(!1)],O.prototype,"_clientId",void 0),n([u(!1)],O.prototype,"_accessToken",void 0),O=n([l("auth","StaticAuthProvider","clientId")],O);class E extends g{}function L(e){return"string"==typeof e?e:"number"==typeof e?e.toString(10):e.id}function P(e){return r(this,void 0,Promise,(function(){return o(this,(function(t){return[2,new Promise((function(t){return setTimeout(t,e)}))]}))}))}var R=function(){function e(e,t,n,r){void 0===r&&(r=!1),this.owner=e,this.event=t,this.listener=n,this._internal=r}return e.prototype.unbind=function(){this.owner.removeListener(this)},e}(),j=function(){function e(){this._eventListeners=new Map,this._internalEventListeners=new Map}return e.prototype.on=function(e,t){return this._addListener(!1,e,t)},e.prototype.addListener=function(e,t){return this._addListener(!1,e,t)},e.prototype.removeListener=function(e,t){this._removeListener(!1,e,t)},e.prototype.registerEvent=function(){var e=this,t=function(n){return e.addListener(t,n)};return t},e.prototype.emit=function(e){for(var t,n,r,i,o=[],a=1;a<arguments.length;a++)o[a-1]=arguments[a];if(this._eventListeners.has(e))try{for(var u=s(this._eventListeners.get(e)),l=u.next();!l.done;l=u.next())l.value.apply(void 0,c(o))}catch(e){t={error:e}}finally{try{l&&!l.done&&(n=u.return)&&n.call(u)}finally{if(t)throw t.error}}if(this._internalEventListeners.has(e))try{for(var d=s(this._internalEventListeners.get(e)),h=d.next();!h.done;h=d.next())h.value.apply(void 0,c(o))}catch(e){r={error:e}}finally{try{h&&!h.done&&(i=d.return)&&i.call(d)}finally{if(r)throw r.error}}},e.prototype.registerInternalEvent=function(){var e=this,t=function(n){return e.addInternalListener(t,n)};return t},e.prototype.addInternalListener=function(e,t){return this._addListener(!0,e,t)},e.prototype.removeInternalListener=function(e,t){this._removeListener(!0,e,t)},e.prototype._addListener=function(e,t,n){var r=e?this._eventListeners:this._internalEventListeners;return r.has(t)?r.get(t).push(n):r.set(t,[n]),new R(this,t,n,e)},e.prototype._removeListener=function(e,t,n){var r=e?this._eventListeners:this._internalEventListeners;if(t)if("object"==typeof t){var i=t;this._removeListener(i._internal,i.event,i.listener)}else{var o=t;if(r.has(o))if(n)for(var s=r.get(o),a=0;-1!==(a=s.indexOf(n));)s.splice(a,1);else r.delete(o)}else r.clear()},e}(),T=function(e){function n(t,n,r,i){var o;void 0===r&&(r={});var s=e.call(this)||this;return s._type=t,s._connectionInfo=n,s._additionalOptions=i,s._retryLimit=1/0,s._initialRetryLimit=3,s._connecting=!1,s._connectionRetryCount=0,s.onReceive=s.registerEvent(),s.onConnect=s.registerEvent(),s.onDisconnect=s.registerEvent(),s.onEnd=s.registerEvent(),s._retryLimit=null!==(o=r.retryLimit)&&void 0!==o?o:1/0,s._logger=r.logger,s}return t(n,e),Object.defineProperty(n.prototype,"isConnected",{get:function(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.isConnected)&&void 0!==t&&t},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isConnecting",{get:function(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.isConnecting)&&void 0!==t?t:this._connecting},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"host",{get:function(){return this._connectionInfo.hostName},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"port",{get:function(){return this._connectionInfo.port},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasSocket",{get:function(){var e,t;return null!==(t=null===(e=this._currentConnection)||void 0===e?void 0:e.hasSocket)&&void 0!==t&&t},enumerable:!1,configurable:!0}),n.prototype.sendLine=function(e){var t;null===(t=this._currentConnection)||void 0===t||t.sendLine(e)},n.prototype.connect=function(){return r(this,void 0,Promise,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this._connect(!0)];case 1:return e.sent(),[2]}}))}))},n.prototype.disconnect=function(){var e;return r(this,void 0,Promise,(function(){var t;return o(this,(function(n){switch(n.label){case 0:return null===(e=this._logger)||void 0===e||e.trace("PersistentConnection disconnect currentConnectionExists:"+Boolean(this._currentConnection).toString()+" connecting:"+this._connecting.toString()),this._connecting=!1,this._currentConnection?(t=this._currentConnection,this._currentConnection=void 0,[4,t.disconnect()]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))}))},n.prototype.assumeExternalDisconnect=function(){var e,t;null===(e=this._logger)||void 0===e||e.trace("PersistentConnection assumeExternalDisconnect"),null===(t=this._currentConnection)||void 0===t||t.assumeExternalDisconnect()},n.prototype.reconnect=function(){return r(this,void 0,Promise,(function(){return o(this,(function(e){switch(e.label){case 0:return[4,this._reconnect(!0)];case 1:return e.sent(),[2]}}))}))},n.prototype._connect=function(e){var t,i,s,a;return void 0===e&&(e=!1),r(this,void 0,Promise,(function(){var r,c,u,l,d,h=this;return o(this,(function(p){switch(p.label){case 0:if(null===(t=this._logger)||void 0===t||t.trace("PersistentConnection connect currentConnectionExists:"+Boolean(this._currentConnection).toString()+" connecting:"+this._connecting.toString()),this._currentConnection||this._connecting)throw new Error("Connection already present");this._connectionRetryCount=0,this._connecting=!0,r=e?this._initialRetryLimit:this._retryLimit,this._retryTimerGenerator=n._getReconnectWaitTime(),c=function(){var t,n,c;return o(this,(function(o){switch(o.label){case 0:(t=u._currentConnection=new u._type(u._connectionInfo,u._logger,u._additionalOptions)).onReceive((function(e){return h.emit(h.onReceive,e)})),t.onConnect((function(){return h.emit(h.onConnect)})),t.onDisconnect((function(e,n){h.emit(h.onDisconnect,e,n),e?(h.emit(h.onEnd,!0),t.disconnect(),h._currentConnection===t&&(h._currentConnection=void 0)):h._connecting||h._reconnect()})),o.label=1;case 1:return o.trys.push([1,3,,5]),[4,t.connect()];case 2:return o.sent(),u._connecting=!1,[2,{value:void 0}];case 3:return n=o.sent(),u._connecting?(null===(i=u._logger)||void 0===i||i.debug("Connection error caught: "+n.message),u._connectionRetryCount>=r?[2,"break"]:(u._connectionRetryCount++,0!==(c=u._retryTimerGenerator.next().value)&&(null===(s=u._logger)||void 0===s||s.info("Retrying in "+c+" seconds")),[4,P(1e3*c)])):[2,{value:void 0}];case 4:return o.sent(),null===(a=u._logger)||void 0===a||a.info(e?"Retrying connection":"Trying to reconnect"),u._connecting?[3,5]:[2,{value:void 0}];case 5:return[2]}}))},u=this,p.label=1;case 1:return this._connectionRetryCount<=r?[5,c()]:[3,3];case 2:return"object"==typeof(l=p.sent())?[2,l.value]:"break"===l?[3,3]:[3,1];case 3:if(d=new Error("Connection failed after trying "+r+" times"),this.emit(this.onEnd,!1,d),e)throw d;return[2]}}))}))},n.prototype._reconnect=function(e){return void 0===e&&(e=!1),r(this,void 0,Promise,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return this.disconnect().catch((function(e){var n;return null===(n=t._logger)||void 0===n?void 0:n.error("Error while disconnecting for the reconnect: "+e.message)})),[4,this._connect(e)];case 1:return n.sent(),[2]}}))}))},n._getReconnectWaitTime=function(){var e,t,n;return o(this,(function(r){switch(r.label){case 0:e=0,t=1,r.label=1;case 1:return e<120?[4,e]:[3,3];case 2:return r.sent(),e=(n=[t,e+t])[0],t=n[1],[3,1];case 3:return[4,120];case 4:return r.sent(),[3,3];case 5:return[2]}}))},n}(j),N=null;"undefined"!=typeof WebSocket?N=WebSocket:"undefined"!=typeof MozWebSocket?N=MozWebSocket:"undefined"!=typeof global?N=global.WebSocket||global.MozWebSocket:"undefined"!=typeof window?N=window.WebSocket||window.MozWebSocket:"undefined"!=typeof self&&(N=self.WebSocket||self.MozWebSocket);var A,F,M=function(e){function n(t,n,r){var i=t.hostName,o=t.port,s=t.secure,a=t.lineBased,c=e.call(this)||this;return c._currentLine="",c._connecting=!1,c._connected=!1,c._manualDisconnect=!1,c.onReceive=c.registerEvent(),c.onConnect=c.registerEvent(),c.onDisconnect=c.registerEvent(),c.onEnd=c.registerEvent(),c._host=i,c._port=o,c._secure=null==s||s,c._lineBased=null!=a&&a,c._logger=n,c._additionalOptions=r,c}return t(n,e),Object.defineProperty(n.prototype,"isConnecting",{get:function(){return this._connecting},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"isConnected",{get:function(){return this._connected},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"host",{get:function(){return this._host},enumerable:!1,configurable:!0}),n.prototype.sendLine=function(e){this._connected&&(e=e.replace(/[\0\r\n]/g,""),this.sendRaw(e+"\r\n"))},n.prototype.assumeExternalDisconnect=function(){var e;null===(e=this._logger)||void 0===e||e.trace("AbstrctConnection assumeExternalDisconnect"),this._connected=!1,this._connecting=!1,this.emit(this.onDisconnect,!1)},n.prototype.receiveRaw=function(e){var t,n;if(this._lineBased){var r=e.split("\r\n");if(this._currentLine+=null!==(t=r.shift())&&void 0!==t?t:"",r.length){this.emit(this.onReceive,this._currentLine),this._currentLine=null!==(n=r.pop())&&void 0!==n?n:"";for(var i=0,o=r;i<o.length;i++){var s=o[i];this.emit(this.onReceive,s)}}}else this.emit(this.onReceive,e)},n}(j),B=function(e){function n(){var t=null!==e&&e.apply(this,arguments)||this;return t._socket=null,t}return t(n,e),Object.defineProperty(n.prototype,"port",{get:function(){return this._port},enumerable:!1,configurable:!0}),Object.defineProperty(n.prototype,"hasSocket",{get:function(){return!!this._socket},enumerable:!1,configurable:!0}),n.prototype.sendRaw=function(e){var t;null===(t=this._socket)||void 0===t||t.send(e)},n.prototype.connect=function(){var e;return r(this,void 0,Promise,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return null===(e=this._logger)||void 0===e||e.trace("WebSocketConnection connect"),[4,new Promise((function(e,n){var r;t._connecting=!0;var i="ws"+(t._secure?"s":"")+"://"+t._host+":"+t.port;t._socket=new N(i,null===(r=t._additionalOptions)||void 0===r?void 0:r.wsOptions),t._socket.onopen=function(){var n;null===(n=t._logger)||void 0===n||n.trace("WebSocketConnection onOpen"),t._connected=!0,t._connecting=!1,t.emit(t.onConnect),e()},t._socket.onmessage=function(e){var n=e.data;t.receiveRaw(n.toString())},t._socket.onerror=function(e){var n;null===(n=t._logger)||void 0===n||n.trace("WebSocketConnection onError message:"+e.message)},t._socket.onclose=function(e){var r,i=t._connected;if(null===(r=t._logger)||void 0===r||r.trace("WebSocketConnection onClose wasConnected:"+i.toString()+" wasClean:"+e.wasClean.toString()),t._connected=!1,t._connecting=!1,e.wasClean)t.emit(t.onDisconnect,!0),t.emit(t.onEnd,!0);else{var o=new Error("["+e.code+"] "+e.reason);t.emit(t.onDisconnect,!1,o),t.emit(t.onEnd,!1,o),i||n(o)}t._socket&&(t._socket.onopen=null,t._socket.onmessage=null,t._socket.onerror=null,t._socket.onclose=null,t._socket=null)}}))];case 1:return n.sent(),[2]}}))}))},n.prototype.disconnect=function(){var e;return r(this,void 0,Promise,(function(){var t=this;return o(this,(function(n){switch(n.label){case 0:return null===(e=this._logger)||void 0===e||e.trace("WebSocketConnection disconnect"),[4,new Promise((function(e){if(t._socket){var n=t.onDisconnect((function(){n.unbind(),e()}));t._socket.close()}else e()}))];case 1:return n.sent(),[2]}}))}))},n}(M),D=i(643),U=i.t(D,2);function $(e){if("number"==typeof e){if(Object.prototype.hasOwnProperty.call(F,e))return e;var t=Object.keys(F).map((function(e){return parseInt(e,10)})).filter((function(t){return!isNaN(t)&&t<e}));return t.length?Math.max.apply(Math,t):F.WARNING}var n=e.replace(/\d+$/,"").toUpperCase();if(!Object.prototype.hasOwnProperty.call(F,n))throw new Error("Unknown log level string: "+e);return F[n]}!function(e){e[e.CRITICAL=0]="CRITICAL",e[e.ERROR=1]="ERROR",e[e.WARNING=2]="WARNING",e[e.INFO=3]="INFO",e[e.DEBUG=4]="DEBUG",e[e.TRACE=7]="TRACE"}(F||(F={}));var W,G,H=U?console.log.bind(console):console.debug.bind(console),z=((A={})[F.CRITICAL]=console.error.bind(console),A[F.ERROR]=console.error.bind(console),A[F.WARNING]=console.warn.bind(console),A[F.INFO]=console.info.bind(console),A[F.DEBUG]=H.bind(console),A[F.TRACE]=console.trace.bind(console),A),q="undefined"==typeof process?[]:null!==(G=null===(W=process.env.LOGGING)||void 0===W?void 0:W.split(";").map((function(e){var t=e.split("=",2),n=t[0],r=t[1];return r?["default"===n?void 0:n.split(":"),$(r)]:null})).filter((function(e){return!!e})).sort((function(e,t){var n,r,i=e[0],o=t[0];return(null!==(n=null==o?void 0:o.length)&&void 0!==n?n:0)-(null!==(r=null==i?void 0:i.length)&&void 0!==r?r:0)})))&&void 0!==G?G:[],V=q.findIndex((function(e){return!e[0]})),Q=void 0;function J(e,t){return t.length<=e.length&&t.every((function(t,n){return t===e[n]}))}function Y(e){for(var t=e.split(":"),n=0,r=q;n<r.length;n++){var i=r[n],o=i[0],s=i[1];if(J(t,o))return s}return Q}-1!==V&&(Q=q[V][1],q.splice(V));var Z,K,X,ee=function(){function e(e){var t,n,r=e.name,i=e.minLevel,o=e.emoji,s=void 0!==o&&o,a=e.colors,c=e.timestamps,u=void 0===c?U:c;this._name=r,this._minLevel=null!==(n=null!==(t=b(i,(function(e){return $(e)})))&&void 0!==t?t:Y(r))&&void 0!==n?n:F.WARNING,this._emoji=s,this._colors=a,this._timestamps=u}return e.prototype.crit=function(e){this.log(F.CRITICAL,e)},e.prototype.error=function(e){this.log(F.ERROR,e)},e.prototype.warn=function(e){this.log(F.WARNING,e)},e.prototype.info=function(e){this.log(F.INFO,e)},e.prototype.debug=function(e){this.log(F.DEBUG,e)},e.prototype.trace=function(e){this.log(F.TRACE,e)},e}(),te=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.log=function(e,t){if(!(e>this._minLevel)){var n=z[e],r="["+this._name+"] "+t;this._timestamps&&(r="["+(new Date).toISOString()+"] "+t),n(r)}},n}(ee),ne=function(){function e(e){var t,n=e.name,r=e.minLevel,i=e.custom;this._minLevel=null!==(t=b(r,(function(e){return $(e)})))&&void 0!==t?t:Y(n),this._override="function"==typeof i?{log:i}:i}return e.prototype.log=function(e,t){this._shouldLog(e)&&this._override.log(e,t)},e.prototype.crit=function(e){this._override.crit?this._shouldLog(F.CRITICAL)&&this._override.crit(e):this.log(F.CRITICAL,e)},e.prototype.error=function(e){this._override.error?this._shouldLog(F.ERROR)&&this._override.error(e):this.log(F.ERROR,e)},e.prototype.warn=function(e){this._override.warn?this._shouldLog(F.WARNING)&&this._override.warn(e):this.log(F.WARNING,e)},e.prototype.info=function(e){this._override.info?this._shouldLog(F.INFO)&&this._override.info(e):this.log(F.INFO,e)},e.prototype.debug=function(e){this._override.debug?this._shouldLog(F.DEBUG)&&this._override.debug(e):this.log(F.DEBUG,e)},e.prototype.trace=function(e){this._override.trace?this._shouldLog(F.TRACE)&&this._override.trace(e):this.log(F.TRACE,e)},e.prototype._shouldLog=function(e){return void 0===this._minLevel||this._minLevel>=e},e}(),re=((Z={})[F.CRITICAL]="",Z[F.ERROR]="",Z[F.WARNING]=" ",Z[F.INFO]=" ",Z[F.DEBUG]="",Z[F.TRACE]="",Z),ie={black:30,red:31,green:32,yellow:33,blue:34,magenta:35,cyan:36,white:37,blackBright:90,redBright:91,greenBright:92,yellowBright:93,blueBright:94,magentaBright:95,cyanBright:96,whiteBright:97},oe={bgBlack:40,bgRed:41,bgGreen:42,bgYellow:43,bgBlue:44,bgMagenta:45,bgCyan:46,bgWhite:47,bgBlackBright:100,bgRedBright:101,bgGreenBright:102,bgYellowBright:103,bgBlueBright:104,bgMagentaBright:105,bgCyanBright:106,bgWhiteBright:107};function se(e,t,n){return function(r){return"["+e+"m"+(n?n(r):r)+"["+t+"m"}}function ae(e){return se(ie[e],39)}function ce(e,t){return se(oe[e],49,t)}var ue,le=((K={})[F.CRITICAL]=ae("red"),K[F.ERROR]=ae("redBright"),K[F.WARNING]=ae("yellow"),K[F.INFO]=ae("blue"),K[F.DEBUG]=ae("magenta"),K[F.TRACE]=se(0,0),K),de=((X={})[F.CRITICAL]=ce("bgRed",ae("white")),X[F.ERROR]=ce("bgRedBright",ae("white")),X[F.WARNING]=ce("bgYellow",ae("black")),X[F.INFO]=ce("bgBlue",ae("white")),X[F.DEBUG]=ce("bgMagenta",ae("black")),X[F.TRACE]=se(7,27),X),he=function(e){function n(){return null!==e&&e.apply(this,arguments)||this}return t(n,e),n.prototype.log=function(e,t){var n,r,i;if(!(e>this._minLevel)){var o=z[e],s="";this._timestamps&&(s+="["+(new Date).toISOString()+"] "),this._emoji&&(s+=re[e]+" "),o(s+=null===(i=null!==(n=this._colors)&&void 0!==n?n:null===(r=process.stdout)||void 0===r?void 0:r.isTTY)||void 0===i||i?de[e](this._name)+" "+de[e](F[e])+" "+le[e](t):"["+this._name+":"+F[e].toLowerCase()+"] "+t)}},n}(ee);class pe extends g{constructor(e){super(`${e} - this should never happen, please file a bug in the GitHub issue tracker`)}}let fe=ue=class extends j{constructor(e){super(),this._topics=new Map,this._pingOnInactivity=60,this._pingTimeout=10,this._onPong=this.registerInternalEvent(),this._onResponse=this.registerInternalEvent(),this.onMessage=this.registerEvent(),this.onConnect=this.registerEvent(),this.onDisconnect=this.registerEvent(),this.onPong=this.registerEvent(),this._logger=function(e){return e.custom?new ne(e):U?new he(e):new te(e)}({name:"twurple:pubsub",emoji:!0,...null==e?void 0:e.logger}),this._connection=new T(B,{hostName:"pubsub-edge.twitch.tv",port:443,secure:!0},{logger:this._logger},{wsOptions:null==e?void 0:e.wsOptions}),this._connection.onConnect((async()=>{this._logger.info("Connection established"),await this._resendListens(),this._topics.size&&(this._logger.info("Listened to previously registered topics"),this._logger.debug(`Previously registered topics: ${Array.from(this._topics.keys()).join(", ")}`)),this._startPingCheckTimer(),this.emit(this.onConnect)})),this._connection.onReceive((e=>{this._receiveMessage(e.trim()),this._startPingCheckTimer()})),this._connection.onDisconnect(((e,t)=>{this._pingCheckTimer&&clearTimeout(this._pingCheckTimer),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeInternalListener(),e?this._logger.info("Disconnected"):t?this._logger.error(`Disconnected unexpectedly: ${t.message}`):this._logger.error("Disconnected unexpectedly"),this.emit(this.onDisconnect,e,t)}))}async listen(e,t,n){"string"==typeof e&&(e=[e]);const r=ue._wrapResolvable(t,n);for(const t of e)this._topics.set(t,r);this.isConnected&&await this._sendListen(e,await this._resolveToken(r))}async unlisten(e){"string"==typeof e&&(e=[e]);for(const t of e)this._topics.delete(t);this.isConnected&&await this._sendUnlisten(e)}async connect(){this._connection.isConnected||this._connection.isConnecting||(this._logger.info("Connecting..."),await this._connection.connect())}async disconnect(){this._logger.info("Disconnecting..."),await this._connection.disconnect()}async reconnect(){await this.disconnect(),await this.connect()}get isConnecting(){return this._connection.isConnecting}get isConnected(){return this._connection.isConnected}get hasAnyTopics(){return this._topics.size>0}async _sendListen(e,t){await this._sendNonced({type:"LISTEN",data:{topics:e,auth_token:t}})}async _sendUnlisten(e){await this._sendNonced({type:"UNLISTEN",data:{topics:e}})}static _wrapResolvable(e,t){switch(typeof e){case"object":return"type"in e?e:{type:"provider",provider:e,scopes:t?[t]:[]};case"string":return{type:"static",token:e};case"function":return{type:"function",function:e};default:throw new pe("Passed unknown type to wrapResolvable: "+typeof e)}}async _resolveToken(e){switch(e.type){case"provider":{const{provider:t,scopes:n}=e,{accessToken:r}=await S(t,n,this._logger);return r.accessToken}case"function":return await e.function();case"static":return e.token;default:throw new pe(`Passed unknown type to resolveToken: ${e.type}`)}}async _resendListens(){const e=new Map;for(const[t,n]of this._topics)e.has(n)?e.get(n).push(t):e.set(n,[t]);const t=new Map;for(const[n,r]of e){const e=await this._resolveToken(n);t.has(e)?t.get(e).push(...r):t.set(e,r)}return await Promise.all(Array.from(t.entries()).map((async([e,t])=>await this._sendListen(t,e))))}async _sendNonced(e){await new Promise(((t,n)=>{const r=Math.random().toString(16).slice(2),i=this._onResponse(((o,s)=>{o===r&&(s?n(new Error(`Error sending nonced ${e.type} packet: ${s}`)):t(),i.unbind())}));e.nonce=r,this._sendPacket(e)}))}_receiveMessage(e){this._logger.debug(`Received message: ${e}`);const t=JSON.parse(e);switch(t.type){case"PONG":this.emit(this._onPong);break;case"RECONNECT":this.reconnect();break;case"RESPONSE":this.emit(this._onResponse,t.nonce,t.error);break;case"MESSAGE":this.emit(this.onMessage,t.data.topic,JSON.parse(t.data.message));break;default:this._logger.warn(`PubSub connection received unexpected message type: ${t.type}`)}}_sendPacket(e){const t=JSON.stringify(e);this._logger.debug(`Sending message: ${t}`),this._connection.sendLine(t)}_pingCheck(){const e=Date.now();this._onPong((()=>{const t=Date.now()-e;this.emit(this.onPong,t,e),this._logger.info(`Current latency: ${t}ms`),this._pingTimeoutTimer&&clearTimeout(this._pingTimeoutTimer),this.removeInternalListener(this._onPong)})),this._pingTimeoutTimer=setTimeout((async()=>{this._logger.error("Ping timeout"),this.removeInternalListener(this._onPong),this._connection.assumeExternalDisconnect()}),1e3*this._pingTimeout),this._sendPacket({type:"PING"})}_startPingCheckTimer(){this._pingCheckTimer&&clearInterval(this._pingCheckTimer),this._connection.isConnected?this._pingCheckTimer=setInterval((()=>this._pingCheck()),1e3*this._pingOnInactivity):this._pingCheckTimer=void 0}};n([u(!1)],fe.prototype,"_logger",void 0),n([u(!1)],fe.prototype,"_topics",void 0),fe=ue=n([l("pubsub","BasicPubSubClient")],fe);let ge=class extends C{constructor(e,t){super(e),this._channelId=t}get channelId(){return this._channelId}get messageId(){return this[w].data.message.id}get messageContent(){return this[w].data.message.content.text}get foundMessageFragments(){return this[w].data.message.content.fragments}get senderId(){return this[w].data.message.sender.user_id}get senderName(){return this[w].data.message.sender.login}get senderDisplayName(){return this[w].data.message.sender.display_name}get senderColor(){return this[w].data.message.sender.chat_color}get sendDate(){return new Date(this[w].data.message.sent_at)}get contentClassification(){return this[w].data.content_classification}get status(){return this[w].data.status}get resolverId(){return this[w].data.resolver_id||null}get resolverName(){return this[w].data.resolver_login||null}};ge=n([l("pubsub","PubSubAutoModQueueMessage","messageId")],ge);let ye=class extends C{get userId(){return this[w].data.user_id}get userName(){return this[w].data.user_name}get message(){return this[w].data.chat_message}get badgeTier(){return this[w].data.badge_tier}};ye=n([l("pubsub","PubSubBitsBadgeUnlockMessage","userId")],ye);let me=class extends C{get userId(){return this[w].data.user_id}get userName(){return this[w].data.user_name}get message(){return this[w].data.chat_message}get bits(){return this[w].data.bits_used}get totalBits(){return this[w].data.total_bits_used}get isAnonymous(){return this[w].data.is_anonymous}};me=n([l("pubsub","PubSubBitsMessage","userId")],me);let ve=class extends C{constructor(e,t){super(e),this._channelId=t}get channelId(){return this._channelId}get type(){return this[w].data.type}get action(){return this[w].data.moderation_action}get args(){return this[w].data.args}get userId(){return this[w].data.created_by_user_id}get userName(){return this[w].data.created_by}};ve=n([l("pubsub","PubSubChatModActionMessage","userId")],ve);let _e=class extends C{get data(){return this[w]}};_e=n([l("pubsub","PubSubCustomMessage")],_e);let be=class extends C{get id(){return this[w].data.redemption.id}get userId(){return this[w].data.redemption.user.id}get userName(){return this[w].data.redemption.user.login}get userDisplayName(){return this[w].data.redemption.user.display_name}get channelId(){return this[w].data.redemption.channel_id}get redemptionDate(){return new Date(this[w].data.redemption.redeemed_at)}get rewardId(){return this[w].data.redemption.reward.id}get rewardTitle(){return this[w].data.redemption.reward.title}get rewardPrompt(){return this[w].data.redemption.reward.prompt}get rewardCost(){return this[w].data.redemption.reward.cost}get rewardIsQueued(){return!this[w].data.redemption.reward.should_redemptions_skip_request_queue}get rewardImage(){return this[w].data.redemption.reward.image}get defaultImage(){return this[w].data.redemption.reward.default_image}get message(){return this[w].data.redemption.user_input}get status(){return this[w].data.redemption.status}};be=n([l("pubsub","PubSubRedemptionMessage","id")],be);let we=class extends C{get userId(){const e=this[w];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?e.recipient_id:e.user_id}get userName(){const e=this[w];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?e.recipient_user_name:e.user_name}get userDisplayName(){const e=this[w];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?e.recipient_display_name:e.display_name}get streakMonths(){const e=this[w];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?0:e.streak_months}get cumulativeMonths(){const e=this[w];return"subgift"===e.context||"anonsubgift"===e.context||"resubgift"===e.context||"anonresubgift"===e.context?e.months:e.cumulative_months}get months(){return this.cumulativeMonths}get time(){return new Date(this[w].time)}get message(){return"subgift"===this[w].context||"anonsubgift"===this[w].context?null:this[w].sub_message}get subPlan(){return this[w].sub_plan}get isResub(){return"resub"===this[w].context}get isGift(){return"subgift"===this[w].context||"resubgift"===this[w].context||"anonsubgift"===this[w].context||"anonresubgift"===this[w].context}get isAnonymous(){return"anonsubgift"===this[w].context||"anonresubgift"===this[w].context}get gifterId(){return this.isGift?this[w].user_id:null}get gifterName(){return this.isGift?this[w].user_name:null}get gifterDisplayName(){return this.isGift?this[w].display_name:null}get giftDuration(){const e=this[w];return"subgift"===e.context||"resubgift"===e.context||"anonsubgift"===e.context||"anonresubgift"===e.context?e.multi_month_duration:null}};we=n([l("pubsub","PubSubSubscriptionMessage","userId")],we);let Ce=class extends C{constructor(e,t){super(e),this._channelId=t}get channelId(){return this._channelId}get messageId(){return this[w].data.message_id}get status(){return this[w].data.status}};Ce=n([l("pubsub","PubSubUserModerationNotificationMessage","messageId")],Ce);let ke=class extends C{get text(){return this[w].data_object.body}get senderId(){return this[w].data_object.from_id.toString()}get senderName(){return this[w].data_object.tags.login}get senderDisplayName(){return this[w].data_object.tags.display_name}};ke=n([l("pubsub","PubSubWhisperMessage","senderId")],ke);let xe=class{constructor(e,t,n,r){this._topic=e,this._userId=t,this._callback=n,this._client=r}get topic(){return this._topic}get userId(){return this._userId}async remove(){await this._client.removeListener(this)}call(e){this._callback(e)}};var Se;n([u(!1)],xe.prototype,"_client",void 0),xe=n([l("pubsub","PubSubListener","userId")],xe);let Ie=Se=class{constructor(e){this._listeners=new Map;const{authProvider:t,pubSubClient:n,logger:r}=e;this._authProvider=t,this._pubSubClient=null!=n?n:new fe({logger:r}),this._pubSubClient.onMessage((async(e,t)=>{const[n,r,...i]=e.split(".");if(this._listeners.has(e)&&r===await this._getUserId()){const r=Se._parseMessage(n,i,t);for(const t of this._listeners.get(e))t.call(r)}}))}async onAutoModQueue(e,t){return await this._addListener("automod-queue",t,"channel:moderate",L(e))}async onBits(e){return await this._addListener("channel-bits-events-v2",e,"bits:read")}async onBitsBadgeUnlock(e){return await this._addListener("channel-bits-badge-unlocks",e,"bits:read")}async onModAction(e,t){return await this._addListener("chat_moderator_actions",t,"channel:moderate",L(e))}async onRedemption(e){return await this._addListener("channel-points-channel-v1",e,"channel:read:redemptions")}async onUserModeration(e,t){return await this._addListener("user-moderation-notifications",t,"chat:read",L(e))}async onSubscription(e){return await this._addListener("channel-subscribe-events-v1",e,"channel:read:subscriptions")}async onWhisper(e){return await this._addListener("whispers",e,"whispers:read")}async onCustomTopic(e,t,n,r){return r?await this._addListener(e,t,n,L(r)):await this._addListener(e,t,n)}async removeListener(e){if(this._listeners.has(e.topic)){const t=this._listeners.get(e.topic).filter((t=>t!==e));0===t.length?(this._listeners.delete(e.topic),await this._pubSubClient.unlisten(`${e.topic}.${e.userId}`),this._pubSubClient.hasAnyTopics||!this._pubSubClient.isConnected&&!this._pubSubClient.isConnecting||await this._pubSubClient.disconnect()):this._listeners.set(e.topic,t)}}static _parseMessage(e,t,n){switch(e){case"automod-queue":return new ge(n,t[0]);case"channel-bits-events-v2":return new me(n);case"channel-bits-badge-unlocks":return new ye(n);case"channel-points-channel-v1":return new be(n);case"channel-subscribe-events-v1":return new we(n);case"chat_moderator_actions":return new ve(n,t[0]);case"user-moderation-notifications":return new Ce(n,t[0]);case"whispers":return new ke(n);default:return new _e(n)}}async _getUserId(){if(this._userId)return this._userId;const{tokenInfo:e}=await S(this._authProvider);if(!e.userId)throw new E("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");return this._userId=e.userId}async _addListener(e,t,n,...r){await this._pubSubClient.connect();const i=await this._getUserId(),o=[e,i,...r].join("."),s=new xe(o,i,t,this);return this._listeners.has(o)?this._listeners.get(o).push(s):(this._listeners.set(o,[s]),await this._pubSubClient.listen(o,this._authProvider,n)),s}};var Oe;n([u(!1)],Ie.prototype,"_authProvider",void 0),n([u(!1)],Ie.prototype,"_pubSubClient",void 0),Ie=Se=n([l("pubsub","SingleUserPubSubClient")],Ie);let Ee=Oe=class{constructor(e){this._userClients=new Map,this._rootClient=null!=e?e:new fe}async registerUserListener(e,t){const n=await Oe._getCorrectUserId(e,t);return this._userClients.set(n,new Ie({authProvider:e,pubSubClient:this._rootClient})),n}getUserListener(e){const t=L(e);if(!this._userClients.has(t))throw new Error(`No auth provider registered for user ID ${t}\nRegister one using:\n\n\tpubSubClient.registerUserListener(authProvider);`);return this._userClients.get(t)}async onAutoModQueue(e,t,n){return await this.getUserListener(e).onAutoModQueue(t,n)}async onBits(e,t){return await this.getUserListener(e).onBits(t)}async onBitsBadgeUnlock(e,t){return await this.getUserListener(e).onBitsBadgeUnlock(t)}async onModAction(e,t,n){return await this.getUserListener(e).onModAction(t,n)}async onRedemption(e,t){return await this.getUserListener(e).onRedemption(t)}async onSubscription(e,t){return await this.getUserListener(e).onSubscription(t)}async onUserModeration(e,t,n){return await this.getUserListener(e).onUserModeration(t,n)}async onWhisper(e,t){return await this.getUserListener(e).onWhisper(t)}async onCustomTopic(e,t,n,r,i){return await this.getUserListener(e).onCustomTopic(t,n,r,i)}static async _getCorrectUserId(e,t){if(t)return L(t);{if("app"===e.tokenType)throw new E("App tokens are not supported by PubSubClient; you need to pass authentication representing a user.");const{tokenInfo:t}=await S(e);if(!t.userId)throw new E("Could not determine a user ID for your token; you might be trying to disguise an app token as a user token.");return t.userId}}};n([u(!1)],Ee.prototype,"_rootClient",void 0),n([u(!1)],Ee.prototype,"_userClients",void 0),Ee=Oe=n([l("pubsub","PubSubClient")],Ee);var Le,Pe,Re,je=i(104),Te=i(227),Ne=i(729),Ae=i(792),Fe=i(153),Me=i(269);function Be(){return Be=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}return e},Be.apply(this,arguments)}!function(e){e[e.Hello=0]="Hello",e[e.Identify=1]="Identify",e[e.Identified=2]="Identified",e[e.Reidentify=3]="Reidentify",e[e.Event=5]="Event",e[e.Request=6]="Request",e[e.RequestResponse=7]="RequestResponse",e[e.RequestBatch=8]="RequestBatch",e[e.RequestBatchResponse=9]="RequestBatchResponse"}(Le||(Le={})),function(e){e[e.None=0]="None",e[e.General=1]="General",e[e.Config=2]="Config",e[e.Scenes=4]="Scenes",e[e.Inputs=8]="Inputs",e[e.Transitions=16]="Transitions",e[e.Filters=32]="Filters",e[e.Outputs=64]="Outputs",e[e.SceneItems=128]="SceneItems",e[e.MediaInputs=256]="MediaInputs",e[e.Vendors=512]="Vendors",e[e.Ui=1024]="Ui",e[e.All=1023]="All",e[e.InputVolumeMeters=65536]="InputVolumeMeters",e[e.InputActiveStateChanged=131072]="InputActiveStateChanged",e[e.InputShowStateChanged=262144]="InputShowStateChanged",e[e.SceneItemTransformChanged=524288]="SceneItemTransformChanged"}(Pe||(Pe={})),function(e){e[e.None=-1]="None",e[e.SerialRealtime=0]="SerialRealtime",e[e.SerialFrame=1]="SerialFrame",e[e.Parallel=2]="Parallel"}(Re||(Re={}));const De=["authentication","rpcVersion"],Ue=Te("obs-websocket-js");class $e extends Error{constructor(e,t){super(t),this.code=void 0,this.code=e}}class We extends Ne{constructor(...e){super(...e),this._identified=!1,this.internalListeners=new Ne,this.socket=void 0}static generateMessageId(){return String(We.requestCounter++)}get identified(){return this._identified}async connect(e="ws://127.0.0.1:4455",t,n={}){var r=this;this.socket&&await this.disconnect();try{const i=this.internalEventPromise("ConnectionClosed"),o=this.internalEventPromise("ConnectionError");return await Promise.race([async function(){const i=await r.createConnection(e);return r.emit("Hello",i),r.identify(i,t,n)}(),new Promise(((e,t)=>{o.then((e=>{e.message&&t(e)})),i.then((e=>{t(e)}))}))])}catch(e){throw await this.disconnect(),e}}async disconnect(){if(!this.socket||this.socket.readyState===Ae.CLOSED)return;const e=this.internalEventPromise("ConnectionClosed");this.socket.close(),await e}async reidentify(e){const t=this.internalEventPromise(`op:${Le.Identified}`);return await this.message(Le.Reidentify,e),t}async call(e,t){const n=We.generateMessageId(),r=this.internalEventPromise(`res:${n}`);await this.message(Le.Request,{requestId:n,requestType:e,requestData:t});const{requestStatus:i,responseData:o}=await r;if(!i.result)throw new $e(i.code,i.comment);return o}cleanup(){this.socket&&(this.socket.onopen=null,this.socket.onmessage=null,this.socket.onerror=null,this.socket.onclose=null,this.socket=void 0,this._identified=!1,this.internalListeners.removeAllListeners())}async createConnection(e){var t;const n=this.internalEventPromise("ConnectionOpened"),r=this.internalEventPromise(`op:${Le.Hello}`);this.socket=new Ae(e,this.protocol),this.socket.onopen=this.onOpen.bind(this),this.socket.onmessage=this.onMessage.bind(this),this.socket.onerror=this.onError.bind(this),this.socket.onclose=this.onClose.bind(this),await n;const i=null==(t=this.socket)?void 0:t.protocol;if(!i)throw new $e(-1,"Server sent no subprotocol");if(i!==this.protocol)throw new $e(-1,"Server sent an invalid subprotocol");return r}async identify(e,t,n={}){let{authentication:r,rpcVersion:i}=e,o=function(e,t){if(null==e)return{};var n,r,i={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(i[n]=e[n]);return i}(e,De);const s=Be({rpcVersion:i},n);r&&t&&(s.authentication=function(e,t,n){const r=Me.stringify(Fe(n+e));return Me.stringify(Fe(r+t))}(r.salt,r.challenge,t));const a=this.internalEventPromise(`op:${Le.Identified}`);await this.message(Le.Identify,s);const c=await a;return this._identified=!0,this.emit("Identified",c),Be({rpcVersion:i},o,c)}async message(e,t){if(!this.socket)throw new Error("Not connected");if(!this.identified&&1!==e)throw new Error("Socket not identified");const n=await this.encodeMessage({op:e,d:t});this.socket.send(n)}async internalEventPromise(e){return new Promise((t=>{this.internalListeners.once(e,t)}))}onOpen(e){Ue("socket.open"),this.emit("ConnectionOpened"),this.internalListeners.emit("ConnectionOpened",e)}async onMessage(e){try{const{op:t,d:n}=await this.decodeMessage(e.data);if(Ue("socket.message: %d %j",t,n),void 0===t||void 0===n)return;switch(t){case Le.Event:{const{eventType:e,eventData:t}=n;return void this.emit(e,t)}case Le.RequestResponse:{const{requestId:e}=n;return void this.internalListeners.emit(`res:${e}`,n)}default:this.internalListeners.emit(`op:${t}`,n)}}catch(e){Ue("error handling message: %o",e)}}onError(e){Ue("socket.error: %o",e);const t=new $e(-1,e.message);this.emit("ConnectionError",t),this.internalListeners.emit("ConnectionError",t)}onClose(e){Ue("socket.close: %s (%d)",e.reason,e.code);const t=new $e(e.code,e.reason);this.emit("ConnectionClosed",t),this.internalListeners.emit("ConnectionClosed",t),this.cleanup()}}We.requestCounter=1,"undefined"!=typeof exports&&Object.defineProperty(exports,"__esModule",{value:!0});const Ge=new class extends We{constructor(...e){super(...e),this.protocol="obswebsocket.json"}async encodeMessage(e){return JSON.stringify(e)}async decodeMessage(e){return JSON.parse(e)}},He=new Ee,ze=document.getElementById("muteImage"),qe=Config;var Ve=!1;!async function(){const e=1e3*qe.time;var t=new je.Timeout(e);const n=new O("f3l7ldc6zwtdunaoe53rzms4icn0pl",qe.token),r=await He.registerUserListener(n),i=document.getElementById("counter");try{const{obsWebSocketVersion:e,negotiatedRpcVersion:t}=await Ge.connect("ws://127.0.0.1:4455",qe.password,{rpcVersion:1});console.log(`Connected to server ${e} (using RPC ${t})`)}catch(e){console.error("Failed to connect",e.code,e.message)}await He.onRedemption(r,(async n=>{if(n.rewardTitle===qe.rewardName){const n=await Ge.call("GetInputMute",{inputName:qe.source});if(console.log(n),n.inputMuted||!t.isFinished&&t.isStarted)n.inputMuted&&!Ve?console.log("Mic already muted."):(console.log("Old time: "+t.timeLeft),t.reset(t.timeLeft+e),console.log("New time: "+t.timeLeft));else{console.log("Mute mic"),Ve=!0,Ge.call("ToggleInputMute",{inputName:qe.source}),ze.style.opacity=1;var r=setInterval((function(){i.innerHTML=Math.round(t.timeLeft/1e3)}),1e3);t.start((()=>{console.log("Unmute mic"),Ge.call("ToggleInputMute",{inputName:qe.source}),ze.style.opacity=0,i.innerHTML="",Ve=!1,clearInterval(r),t=new je.Timeout(e)}))}}}))}()})()})();